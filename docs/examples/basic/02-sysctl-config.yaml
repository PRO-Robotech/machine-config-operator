# Kernel network parameters for Kubernetes
# Optimizes networking and memory settings
apiVersion: mco.in-cloud.io/v1alpha1
kind: MachineConfig
metadata:
  name: sysctl-network
  labels:
    mco.in-cloud.io/pool: worker
spec:
  priority: 40
  files:
    - path: /etc/sysctl.d/99-kubernetes.conf
      content: |
        # Networking
        net.ipv4.ip_forward = 1
        net.bridge.bridge-nf-call-iptables = 1
        net.bridge.bridge-nf-call-ip6tables = 1
        
        # Performance
        net.core.somaxconn = 65535
        net.core.netdev_max_backlog = 65536
        net.ipv4.tcp_max_syn_backlog = 65535
        
        # Memory
        vm.swappiness = 10
        vm.max_map_count = 262144
      mode: 420

